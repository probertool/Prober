tar xvzf 

mkdir nginx-1.3.9-install
#mkdir openssl-101f-install

cd openssl-OpenSSL_1_0_1f/
####./config -DOPENSSL_NO_BUF_FREELISTS --prefix=/root/llvm/codesample/real-effectiveness/heartbleed/openssl-101f-install
./config -DOPENSSL_NO_BUF_FREELISTS --prefix=/root/llvm/codesample/real-effectiveness/heartbleed/openssl-OpenSSL_1_0_1f/.openssl
nano Makefile EX_LIBS=-rdynamic /root/llvm/Prober/libprober.so
make
make install_sw

cd ..

cd ngnix-1.3.9/
nano auto/lib/openssl/make:59: comment the 4 lines
nano auto/unix:681: -rdynamic /root/llvm/Prober/libprober.so
LDFLAGS="-rdynamic /root/llvm/Prober/libprober.so" ./configure --prefix=/root/llvm/codesample/real-effectiveness/heartbleed/nginx-1.3.9-install --with-http_ssl_module --with-openssl=/root/llvm/codesample/real-effectiveness/heartbleed/openssl-OpenSSL_1_0_1f
make
make install

cd ..
cd openssl-OpenSSL_1_0_1f/
openssl genrsa -out example.key 2048
openssl req -new -key example.key -out example.csr
openssl x509 -req -days 365 -in example.csr -signkey example.key -out example.crt

cd ..
cp ./openssl-OpenSSL_1_0_1f/example.* ./nginx-1.3.9-install/conf/

mv ./nginx-1.3.9-install/conf/nginx.conf ./nginx-1.3.9-install/conf/nginx.conf.original

cp nginx.conf to ./nginx-1.3.9-install/conf/
